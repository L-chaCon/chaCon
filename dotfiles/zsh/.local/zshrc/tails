# vim: ft=zsh

alias aws-login="aws sso login --sso-session tails && aws-docker-login"
alias aws-docker-login="aws ecr get-login-password --region eu-west-1 --profile=production | docker login --username AWS --password-stdin 426105708615.dkr.ecr.eu-west-1.amazonaws.com"

alias mf="make format"
alias mt="make test"
alias mi="make install"

tails-pip () {
    CA_TOKEN=$(aws codeartifact get-authorization-token --profile production --domain tails --domain-owner 426105708615 --query authorizationToken --output text)
    INDEX_URL="https://aws:$CA_TOKEN@tails-426105708615.d.codeartifact.eu-west-1.amazonaws.com/pypi/tails/simple/"
    VENV=$(dirname $(dirname $(pyenv which python)))
    echo "[global]\nindex-url = $INDEX_URL" > $VENV/pip.conf
    printf "Added Tails pip config to use Tails PyPi for: $VENV\n"
    printf "$(cat $VENV/pip.conf)\n"
}

poetry-tails() {
  export POETRY_HTTP_BASIC_TAILS_USERNAME=aws
  export POETRY_HTTP_BASIC_TAILS_PASSWORD=$(cat .codeartifact-token)
  echo $POETRY_HTTP_BASIC_TAILS_USERNAME
  echo $POETRY_HTTP_BASIC_TAILS_PASSWORD
}
